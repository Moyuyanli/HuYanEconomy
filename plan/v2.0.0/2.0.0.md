# 2.0.0 版本计划

## 简单计划

### refactor 重构计划
- [x] 全部代码kotlin重构
- [x] EconomyUtil工具按项目需求重构
    让该工具支持多种类银行存款,用于提供给私人银行系统使用

### fix 修复计划

- [x] 修复富豪榜渲染群名称展示为空问题
- [x] 修复功能性道具红牛使用失败问题
- [x] 修复鱼塘升级只扣钱不升级问题
- [x] 修复版本迭代带来的道具code在数据库中的code字段和data详细信息中的code均为空问题

### feat 新增计划

- [x] 新增口令红包功能
- [x] 新增富豪榜关于银行总额占比显示
- [x] 新增一键存款指令:`存款!`一键指令对用户当前钱包余额的整数部分存入默认银行

## 里程碑计划

完成私人银行模块,设计文档:[私人银行系统.md](%E7%A7%81%E4%BA%BA%E9%93%B6%E8%A1%8C%E7%B3%BB%E7%BB%9F.md)
该文档说明已迭代,新任务需求在此文档中申明

### 用户指令

语义说明:
* 银行账户:以银行的身份在主银行的存款,账户在EconomyUtil中使用自定义用户实现
* 银行仓库:银行最外层的流动资金库,直接在数据库中存储
* 银行:用户创建的银行（PrivateBank 模块）

指令格式说明:
- (xx) 代表xx必填
- [xx] 代表xx选填
- '/'  或的语义

1.行长指令
- 银行创建 (code) (name)
前置条件:用户在主银行存款大于100M金额
创建后将用户的主银行100M存款的80%以银行账户存入,20%取出来放到银行的
一个用户只能拥有一个银行
银行默认为3星
- 银行描述修改
前置条件:如果用户有创建银行
将用户的下一条消息全部修改为现在的银行描述
- 银行利率变更 (rate/max/min/now)
前置条件:如果用户有创建银行
识别rate,范围必须是主银行的利率的±0.3
如果填max则代表自动调整至主银行的+0.3
如果填min则代表自动调整至主银行的-0.3
如果填now则代表跟主银行同步
- 银行放贷 (money) (rate)
前置条件:如果用户有创建银行
转移money资金到银行的放贷仓库,并表明这笔贷款的利息rate
放贷信息应该是多笔的,行长可以放贷多笔不同金额不同利息的贷款本金
放贷笔数应该跟银行星级相关,利息也跟星级相关
用户在贷款后,应该在14天内还完本金+利息,这个总额在贷款时就计算好,到期如果没还,自动从用户银行->钱包余额扣款.
- 国卷竞标 (国卷code) (溢价金额money) (接受利息rate)
国卷竞标具体规则请阅读:
* [text](<私人银行与国卷系统：核心补充规范 (v1.1).md>)
* [text](<私人银行系统补充规范：多维动态竞标机制 (v1.2).md>)

2.用户指令
- 银行信息 [code/name]
- 银行列表
在不填的情况下,检查用户是否有银行,有则展示银行信息
没有则不响应
在填参的情况下,查询相关银行信息展示

- 存款 (money) [code/name]
给userInfo添加一个默认银行的字段,没填或空则或者参数为空则存默认银行
填了存对应银行

- 取款 (money) [code/name]
同上

- 银行评分 (no) (description) [code/name]
用户在存款超过7天的银行评分,针对一个银行的评分一个月只能评分两次次
未超过7天无法评分

- 贷款 (money) [code/name]
优先尝试从默认银行贷款,主行不支持贷款
如果能贷款,则贷款成功,金额添加到对应银行的存款中

- 还款 (money) [code/name]
同理.补充参考:[text](<私人银行与国卷系统：核心补充规范 (v1.1).md>)

### 完成度

1.指令完成度

- [x] 银行创建
- [x] 银行描述修改
- [x] 银行利率变更
- [x] 银行放贷
- [x] 狐卷竞标(统一改为狐卷吧,用来避免敏感词)
- [x] 银行信息
- [x] 银行列表
- [x] 存款
- [x] 取款
- [x] 银行评分
- [x] 贷款
- [x] 还款

2.核心逻辑完成度

- [x] 银行,银行金库,银行贷款信息,银行国卷信息,银行客户信息等相关实体创建
- [x] 银行默认利率修改及结算功能
- [x] 银行存款账号存款取款评分功能
- [x] 银行狐卷竞标功能
- [x] 银行放贷,贷款,还款功能
- [x] 银行总金额统计功能(用于富豪榜上榜计算)

## 逻辑校验

- [x] buildPlugin 测试编译可行


## 补充修复 

### 修复
- [x] 银行信息指令和银行列表指令重复  
银行信息是指默认展示当前用户拥有的银行信息,没有银行则跳过
或者银行信息 (code/name) 展示指定银行信息
银行列表是指展示简单的银行信息列表,不是展示详情,
- [x] 处理所有类似'银行列表','银行 列表' 这类指令字符问题,统一去掉'银行 列表'这种非常规指令,另外
对于MessageMatchingEnum.REGULAR类型的指令匹配只会匹配第一条text作为正则规则
- [x] 银行信息展示优化,比如行长: 放空(qq号)  这类,优先展示nick,再展示qq
- [x] 银行就叫银行,不用叫私人银行,只是这个功能模块名叫私人银行模块,修复项目中的部分注释和命名
    - 用户可见输出已统一使用“银行”称呼（代码层模块/包名保持 PrivateBank）。
    - 保留“私银/私人银行”作为兼容指令别名（不作为主要文档称呼）。
- [x] 现在的部分action功能不纯净了,请按照以下结构修复:
action: 控制层/入口层:用于接收指令验证参数,分发控制
usecase: 功能层,单纯作用于自身功能的层,大部分功能实现都在这里
manager: 管理层,提供自身模块对外api的地方,这些api部分自身模块也坑能调用,是其他功能模块调用本模块的入口
repository: 数据层,提供自身相关data的数据封装
    - 已完成：Bank/Transfer/PrivateBank/Lottery/UserStatus
    - 已完成：Rob/Sign/Title/Funding 等
- [x] 全部功能的代码分层设计校验,参考上面

### 校验

- [x] buildPlugin 测试编译可行