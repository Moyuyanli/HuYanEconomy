# 2.0.0 实际执行记录

更新时间：2026-01-17

## 本次交付目标

- 完成 2.0.0 文档“补充修复/分层重构/道具 code 修复”等要求，并保证 `buildPlugin` 可编译打包。

## 已完成事项（摘要）

- 银行指令修复：拆分“银行信息/银行列表”语义、去除不规范空格指令变体、REGULAR 多 text 仅首条生效的兼容处理、行长展示优先 nick。
- 道具 code 根因修复：补齐 Props 序列化/反序列化/更新/Repair 的兜底链路，避免数据库列与 JSON 中 code 为空导致后续异常。
- 分层重构（action 变薄）：已将 Bank/Transfer/PrivateBank/Lottery/UserStatus 的主要业务逻辑迁移到 usecase/manager，并修正启动初始化入口。
- 分层重构补全：完成 Rob/Sign/Title/Funding 的 action 瘦身；Sign 的事件监听逻辑下沉至 manager。
- 用户侧命名统一：用户可见输出统一使用“银行”称呼（代码层模块名仍为 PrivateBank，保留“私银/私人银行”作为兼容指令别名）。
- Manager API 文档：新增并维护 `plan/v2.0.0/manager-api.md`，汇总 manager 包对外 API。

## 关键改动点（文件）

- 用户状态引用清理与编译修复：
  - src/main/kotlin/cn/chahuyun/economy/usecase/GamesUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/manager/GamesManager.kt
  - src/main/kotlin/cn/chahuyun/economy/action/RobAction.kt
  - src/main/kotlin/cn/chahuyun/economy/HuYanEconomy.kt
- 银行（PrivateBank 模块）用户侧文案统一：
  - src/main/kotlin/cn/chahuyun/economy/usecase/PrivateBankUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/privatebank/PrivateBankService.kt
  - src/main/kotlin/cn/chahuyun/economy/privatebank/PrivateBankFoxBondService.kt
  - src/main/kotlin/cn/chahuyun/economy/manager/PrivateBankManager.kt
  - src/main/kotlin/cn/chahuyun/economy/utils/EconomyUtil.kt
  - src/main/kotlin/cn/chahuyun/economy/entity/UserInfo.kt
  - src/main/kotlin/cn/chahuyun/economy/entity/privatebank/*.kt

- 分层重构补全（Rob/Sign/Title/Funding）：
  - src/main/kotlin/cn/chahuyun/economy/action/RobAction.kt
  - src/main/kotlin/cn/chahuyun/economy/usecase/RobUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/manager/RobManager.kt
  - src/main/kotlin/cn/chahuyun/economy/action/SignAction.kt
  - src/main/kotlin/cn/chahuyun/economy/usecase/SignUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/manager/SignManager.kt
  - src/main/kotlin/cn/chahuyun/economy/action/TitleAction.kt
  - src/main/kotlin/cn/chahuyun/economy/usecase/TitleUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/action/FundingAction.kt
  - src/main/kotlin/cn/chahuyun/economy/usecase/FundingUsecase.kt
  - src/main/kotlin/cn/chahuyun/economy/HuYanEconomy.kt

- Manager API 汇总文档：
  - plan/v2.0.0/manager-api.md

## 构建验证

- Windows：`./gradlew.bat buildPlugin --no-daemon --console=plain`
- 结果：BUILD SUCCESSFUL
- 备注：构建过程中可能出现 signing 配置提示（不影响 `buildPlugin` 产物生成）。

## 待办（下一步）

- （已完成）Rob/Sign/Title/Funding 分层重构与引用迁移。
- 同步 README：如需把 manager API 文档的摘要同步到 README，可继续追加。
